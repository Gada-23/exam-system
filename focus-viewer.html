<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Areas - Exit Exam Preparation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%232772a0;stop-opacity:1' /><stop offset='100%' style='stop-color:%23ccddea;stop-opacity:1' /></linearGradient></defs><rect width='100' height='100' fill='url(%23grad)' rx='15'/><path d='M25 30 L25 75 Q25 80 30 80 L70 80 Q75 80 75 75 L75 30 Q75 25 70 25 L30 25 Q25 25 25 30' fill='white' opacity='0.9'/><path d='M45 35 L45 70' stroke='%232772a0' stroke-width='2' fill='none'/><circle cx='35' cy='45' r='3' fill='%232772a0'/><circle cx='55' cy='45' r='3' fill='%232772a0'/><circle cx='35' cy='58' r='3' fill='%23ccddea'/><circle cx='55' cy='58' r='3' fill='%23ccddea'/><path d='M40 20 L35 15 L30 20 L32 25 L38 25 Z' fill='white' stroke='%23ccddea' stroke-width='1.5'/></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Focus Area Viewer Styles */
        .focus-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .focus-header {
            text-align: center;
            color: white;
            margin-bottom: 50px;
            animation: fadeIn 0.6s ease-in;
        }

        .focus-header h1 {
            font-size: 36px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .focus-header .subtitle {
            font-size: 18px;
            opacity: 0.95;
            font-weight: 300;
            color: white;
        }

        .loading-indicator {
            text-align: center;
            padding: 60px;
            color: white;
            grid-column: 1 / -1;
        }

        .loading-indicator i {
            font-size: 50px;
            margin-bottom: 15px;
            animation: spin 1.5s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Course Grid */
        .course-grid-focus {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .course-card-focus {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(39, 114, 160, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .course-card-focus:hover {
            transform: translateY(-5px);
            border-color: #2772a0;
            box-shadow: 0 15px 40px rgba(39, 114, 160, 0.3);
        }

        .course-card-focus::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(135deg, #2772a0, #1a5a80);
        }

        .course-icon-focus {
            font-size: 48px;
            color: #2772a0;
            margin-bottom: 15px;
        }

        .course-card-focus h3 {
            color: #2772a0;
            font-size: 22px;
            margin-bottom: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .completion-badge {
            background: #ffc107;
            color: #333;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .completion-badge i {
            font-size: 10px;
        }

        .completion-badge.complete {
            background: #28a745;
            color: white;
        }

        .course-card-focus p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .course-stats {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-badge {
            background: #e8f0f5;
            color: #2772a0;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        /* Focus Viewer */
        .focus-viewer {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(39, 114, 160, 0.2);
            display: none;
            margin-top: 30px;
        }

        .focus-viewer.active {
            display: block;
            animation: slideUp 0.6s ease-out;
        }

        /* Navigation Bar */
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f2f5;
            flex-wrap: wrap;
            gap: 15px;
        }

        .nav-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-link {
            background: none;
            border: 2px solid #2772a0;
            color: #2772a0;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .nav-link:hover {
            background: #2772a0;
            color: white;
        }

        .nav-link.active {
            background: #2772a0;
            color: white;
        }

        .nav-progress {
            color: #666;
            font-size: 14px;
        }

        .nav-progress i {
            color: #2772a0;
            margin-right: 5px;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0 20px;
            gap: 15px;
        }

        .nav-btn {
            background: #f8f9fa;
            border: 2px solid #2772a0;
            color: #2772a0;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            min-width: 140px;
            justify-content: center;
        }

        .nav-btn:hover:not(:disabled) {
            background: #2772a0;
            color: white;
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #ccc;
            color: #999;
        }

        .position-indicator {
            background: #e8f0f5;
            padding: 8px 20px;
            border-radius: 30px;
            color: #2772a0;
            font-weight: 600;
            font-size: 14px;
        }

        .position-indicator i {
            margin: 0 5px;
        }

        /* Chapter Grid */
        .chapter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .chapter-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
            position: relative;
        }

        .chapter-card:hover {
            border-color: #2772a0;
            background: #f0f2f5;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(39, 114, 160, 0.1);
        }

        .chapter-card.active {
            border-color: #2772a0;
            background: #e8f0f5;
        }

        .chapter-number {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #2772a0;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .chapter-card h4 {
            color: #2772a0;
            font-size: 18px;
            margin: 15px 0 8px;
            font-weight: 600;
        }

        .chapter-card p {
            color: #666;
            font-size: 13px;
            margin-bottom: 15px;
            min-height: 40px;
        }

        .chapter-badge {
            background: white;
            color: #2772a0;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
            font-weight: 600;
            border: 1px solid #2772a0;
        }

        .missing-chapter {
            opacity: 0.6;
            cursor: not-allowed;
            background: #f5f5f5;
            border: 2px dashed #ccc;
        }

        .missing-chapter:hover {
            transform: none;
            border-color: #ccc;
        }

        /* Topic List */
        .topic-list {
            margin: 20px 0;
        }

        .topic-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .topic-item:hover {
            border-left-color: #2772a0;
            background: #f0f2f5;
            transform: translateX(5px);
        }

        .topic-item.active {
            border-left-color: #2772a0;
            background: #e8f0f5;
        }

        .topic-icon {
            width: 40px;
            height: 40px;
            background: #2772a0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .topic-content {
            flex: 1;
        }

        .topic-content h4 {
            color: #333;
            font-size: 16px;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .topic-content p {
            color: #666;
            font-size: 13px;
        }

        /* Content Display */
        .content-display {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
        }

        .content-title {
            color: #2772a0;
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .content-body {
            color: #555;
            line-height: 1.8;
            font-size: 16px;
        }

        .content-body h4 {
            color: #2772a0;
            font-size: 18px;
            margin: 20px 0 10px;
        }

        .content-body table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .content-body th {
            background: #2772a0;
            color: white;
            padding: 10px;
            text-align: left;
        }

        .content-body td {
            padding: 8px;
            border: 1px solid #ddd;
        }

        .content-body tr:nth-child(even) {
            background: #f8f9fa;
        }

        /* Highlight Boxes */
        .key-points-box {
            background: #e8f0f5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .key-points-box h5 {
            color: #2772a0;
            font-size: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .key-points-box ul {
            list-style: none;
            padding: 0;
        }

        .key-points-box li {
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .key-points-box li i {
            color: #2772a0;
            margin-top: 3px;
        }

        .formula-box {
            background: #fff3cd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .example-box {
            background: #d4edda;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .tip-box {
            background: #f8f9fa;
            border-left: 4px solid #2772a0;
            border-radius: 0 10px 10px 0;
            padding: 20px;
            margin: 20px 0;
        }

        /* Back Button */
        .back-home-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #f8f9fa;
            color: #2772a0;
            padding: 10px 20px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-home-btn:hover {
            background: #2772a0;
            color: white;
        }

        /* Info Messages */
        .info-message {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-message i {
            font-size: 20px;
        }

        /* No Content Message */
        .no-content {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .no-content i {
            font-size: 60px;
            color: #2772a0;
            margin-bottom: 15px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-buttons {
                flex-direction: column;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .topic-item {
                flex-direction: column;
                text-align: center;
            }
            
            .nav-bar {
                flex-direction: column;
                text-align: center;
            }
            
            .course-grid-focus {
                grid-template-columns: 1fr;
            }
            
            .chapter-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<!-- FOCUS AREA VIEWER -->
<section class="page" style="display: block; padding: 0;">
    <div class="focus-container">
        
        <!-- Header -->
        <div class="focus-header">
            <h1><i class="fas fa-bullseye"></i> Focus Areas of Exit Exam</h1>
            <p class="subtitle">Quick revision notes for each course based on Ministry of Education Blueprint</p>
        </div>

        <!-- Simple Back to Home Link -->
        <a href="index.html" class="back-home-btn">
            <i class="fas fa-home"></i> Back to Home
        </a>

        <!-- Course Grid -->
        <div id="focusCourseGrid" class="course-grid-focus">
            <div class="loading-indicator">
                <i class="fas fa-circle-notch fa-spin"></i>
                <p>Loading focus areas...</p>
            </div>
        </div>

        <!-- Focus Area Viewer -->
        <div id="focusViewer" class="focus-viewer">
            <!-- Simple Navigation Bar -->
            <div class="nav-bar" id="navBar">
                <!-- Will be populated dynamically -->
            </div>

            <!-- Main Content Area -->
            <div id="focusContent" class="content-display">
                <!-- Content will be populated -->
            </div>

            <!-- Navigation Buttons -->
            <div class="nav-buttons" id="navButtons">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>
</section>

<!-- Load the focus area loader -->
<script src="FocusAreaOfExitExam/loader.js"></script>

<script>
    // ===============================
    // FOCUS AREA VIEWER - MAIN SCRIPT
    // ===============================

    // Navigation state
    let currentState = {
        view: 'courses',
        courseKey: null,
        chapterId: 0,
        topicId: 0
    };

    // Course display names mapping for consistent ordering
    const COURSE_DISPLAY_ORDER = [
        'artificialIntelligence',
        'computerSecurity',
        'operatingSystem',
        'dataCommunicationNetworking',
        'compilerDesign',
        'automataComplexityTheory',
        'computerOrganizationArchitecture',
        'networkSystemAdministration',
        'databaseSystems',
        'dataStructuresAlgorithms',
        'softwareEngineering',
        'webProgramming',
        'designAnalysisAlgorithms'
    ];

    // Wait for focus areas to load
    function waitForFocusAreas() {
        const grid = document.getElementById('focusCourseGrid');
        
        if (window.focusArea && Object.keys(window.focusArea).length > 0) {
            console.log("‚úÖ Focus areas loaded, displaying courses");
            grid.innerHTML = ''; // Clear loading indicator
            displayCourses();
        } else {
            console.log("‚è≥ Waiting for focus areas to load...");
            setTimeout(waitForFocusAreas, 500);
        }
    }

    // Display course grid
    function displayCourses() {
        const grid = document.getElementById('focusCourseGrid');
        const viewer = document.getElementById('focusViewer');
        
        currentState.view = 'courses';
        grid.style.display = 'grid';
        viewer.classList.remove('active');
        
        grid.innerHTML = '';
        
        const courses = window.focusArea || {};
        
        if (Object.keys(courses).length === 0) {
            grid.innerHTML = `
                <div class="no-content">
                    <i class="fas fa-frown"></i>
                    <h3>No Focus Areas Found</h3>
                    <p>Focus area notes are being prepared. Please check back later.</p>
                    <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #2772a0; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-sync-alt"></i> Reload Page
                    </button>
                </div>
            `;
            return;
        }
        
        // Sort courses by predefined order
        const sortedCourses = COURSE_DISPLAY_ORDER.filter(key => courses[key]);
        
        // Add any courses not in the predefined order at the end
        Object.keys(courses).forEach(key => {
            if (!COURSE_DISPLAY_ORDER.includes(key)) {
                sortedCourses.push(key);
            }
        });
        
        sortedCourses.forEach(courseKey => {
            const course = courses[courseKey];
            
            const card = document.createElement('div');
            card.className = 'course-card-focus';
            card.onclick = () => showChapters(courseKey);
            
            // Add completion badge
            let completionBadge = '';
            if (course.expectedChapters && course.totalChapters < course.expectedChapters) {
                completionBadge = `<span class="completion-badge"><i class="fas fa-exclamation-triangle"></i> ${course.totalChapters}/${course.expectedChapters}</span>`;
            } else if (course.expectedChapters) {
                completionBadge = `<span class="completion-badge complete"><i class="fas fa-check"></i> Complete</span>`;
            }
            
            card.innerHTML = `
                <div class="course-icon-focus">
                    <i class="fas ${course.icon || 'fa-book'}"></i>
                </div>
                <h3>${course.title} ${completionBadge}</h3>
                <p>${course.description || 'Complete focus notes for exit exam preparation.'}</p>
                <div class="course-stats">
                    <span class="stat-badge"><i class="fas fa-book"></i> ${course.chapters?.length || 0} Chapters</span>
                    <span class="stat-badge"><i class="fas fa-question"></i> ${course.totalQuestions || 6} Questions</span>
                </div>
            `;
            
            grid.appendChild(card);
        });
    }

    // Show chapters for selected course
    function showChapters(courseKey) {
        const course = window.focusArea[courseKey];
        if (!course || !course.chapters) return;
        
        currentState.view = 'chapters';
        currentState.courseKey = courseKey;
        currentState.chapterId = 0;
        
        const grid = document.getElementById('focusCourseGrid');
        const viewer = document.getElementById('focusViewer');
        
        grid.style.display = 'none';
        viewer.classList.add('active');
        
        updateNavBar('chapters');
        updateNavButtons('chapters');
        
        // Show completion status
        let completionMessage = '';
        if (course.expectedChapters && course.totalChapters < course.expectedChapters) {
            completionMessage = `
                <div class="info-message">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Note:</strong> This course has ${course.totalChapters} out of ${course.expectedChapters} chapters available. 
                        The remaining chapters are being prepared and will be added soon.
                    </div>
                </div>
            `;
        }
        
        let chaptersHtml = `
            <div class="content-title">
                <i class="fas ${course.icon || 'fa-book'}"></i> ${course.title}
                ${course.expectedChapters ? `<span style="font-size: 14px; background: #e8f0f5; padding: 5px 12px; border-radius: 20px; margin-left: 10px;">
                    ${course.totalChapters}/${course.expectedChapters} Chapters
                </span>` : ''}
            </div>
            ${completionMessage}
            <div class="chapter-grid">
        `;
        
        // Sort chapters by id
        const sortedChapters = [...course.chapters].sort((a, b) => a.id - b.id);
        
        sortedChapters.forEach((chapter) => {
            // Get chapter number if available
            const chapterNumber = chapter.number || (chapter.id + 1);
            
            chaptersHtml += `
                <div class="chapter-card" onclick="showTopics(${chapter.id})">
                    <span class="chapter-number">Ch ${chapterNumber}</span>
                    <i class="fas ${chapter.icon || 'fa-file'}" style="font-size: 36px; color: #2772a0; margin-bottom: 10px;"></i>
                    <h4>${chapter.title}</h4>
                    <p>${chapter.description || 'Click to view topics'}</p>
                    <span class="chapter-badge">
                        <i class="fas fa-file-alt"></i> ${chapter.data?.sections?.length || 0} topics
                    </span>
                </div>
            `;
        });
        
        // If there are expected chapters that are missing, show placeholders
        if (course.expectedChapters && course.totalChapters < course.expectedChapters) {
            for (let i = course.totalChapters; i < course.expectedChapters; i++) {
                const chapterNum = i + 1;
                chaptersHtml += `
                    <div class="chapter-card missing-chapter" onclick="event.preventDefault()">
                        <span class="chapter-number">Ch ${chapterNum}</span>
                        <i class="fas fa-clock" style="font-size: 36px; color: #999; margin-bottom: 10px;"></i>
                        <h4 style="color: #999;">Chapter ${chapterNum}: Coming Soon</h4>
                        <p style="color: #999;">This chapter is being prepared</p>
                        <span class="chapter-badge" style="background: #f5f5f5; color: #999; border-color: #ccc;">
                            <i class="fas fa-hourglass-half"></i> In Progress
                        </span>
                    </div>
                `;
            }
        }
        
        chaptersHtml += '</div>';
        
        document.getElementById('focusContent').innerHTML = chaptersHtml;
    }

    // Show topics for selected chapter
    function showTopics(chapterId) {
        const course = window.focusArea[currentState.courseKey];
        if (!course || !course.chapters || !course.chapters[chapterId]) return;
        
        currentState.view = 'topics';
        currentState.chapterId = chapterId;
        
        updateNavBar('topics');
        updateNavButtons('topics');
        
        const chapter = course.chapters[chapterId];
        const sections = chapter.data?.sections || [];
        
        let topicsHtml = `
            <div class="content-title">
                <i class="fas ${chapter.icon || 'fa-file'}"></i> ${chapter.title}
            </div>
            <div class="topic-list">
        `;
        
        if (sections.length === 0) {
            topicsHtml += `
                <div class="no-content" style="padding: 40px;">
                    <i class="fas fa-file-alt"></i>
                    <h3>No Topics Available</h3>
                    <p>This chapter doesn't have any topics yet.</p>
                </div>
            `;
        } else {
            sections.forEach((section, index) => {
                const topicCount = section.keyPoints ? section.keyPoints.length : 0;
                topicsHtml += `
                    <div class="topic-item" onclick="showContent(${chapterId}, ${index})">
                        <div class="topic-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="topic-content">
                            <h4>${section.title}</h4>
                            <p>${topicCount > 0 ? topicCount + ' key points' : 'Click to read'}</p>
                        </div>
                        <i class="fas fa-chevron-right" style="color: #2772a0;"></i>
                    </div>
                `;
            });
        }
        
        topicsHtml += '</div>';
        
        document.getElementById('focusContent').innerHTML = topicsHtml;
    }

    // Show content for selected topic
    function showContent(chapterId, topicId) {
        const course = window.focusArea[currentState.courseKey];
        if (!course || !course.chapters || !course.chapters[chapterId]) return;
        
        currentState.view = 'content';
        currentState.chapterId = chapterId;
        currentState.topicId = topicId;
        
        updateNavBar('content');
        updateNavButtons('content');
        
        const chapter = course.chapters[chapterId];
        const sections = chapter.data?.sections || [];
        const topic = sections[topicId];
        
        if (!topic) return;
        
        let contentHtml = `
            <div class="content-title">
                <i class="fas fa-file-alt"></i> ${topic.title}
            </div>
            <div class="content-body">
                ${topic.content || '<p>Content not available</p>'}
        `;
        
        if (topic.keyPoints && topic.keyPoints.length > 0) {
            contentHtml += `
                <div class="key-points-box">
                    <h5><i class="fas fa-star"></i> Key Points</h5>
                    <ul>
                        ${topic.keyPoints.map(point => `<li><i class="fas fa-check-circle"></i> ${point}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        if (topic.formulas && topic.formulas.length > 0) {
            contentHtml += `
                <div class="formula-box">
                    <h5><i class="fas fa-square-root-alt"></i> Important Formulas</h5>
                    <ul>
                        ${topic.formulas.map(formula => `<li><i class="fas fa-calculator"></i> ${formula}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        if (topic.examples && topic.examples.length > 0) {
            contentHtml += `
                <div class="example-box">
                    <h5><i class="fas fa-lightbulb"></i> Examples</h5>
                    ${topic.examples.map(ex => `
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #b5d8b5;">
                            <p><strong>Q:</strong> ${ex.question}</p>
                            <p><strong>A:</strong> ${ex.answer}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        contentHtml += '</div>';
        
        document.getElementById('focusContent').innerHTML = contentHtml;
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Update navigation bar
    function updateNavBar(view) {
        const course = currentState.courseKey ? window.focusArea[currentState.courseKey] : null;
        const navBar = document.getElementById('navBar');
        
        let navHtml = '<div class="nav-links">';
        
        if (view === 'chapters') {
            navHtml += `
                <button class="nav-link active" onclick="showChapters('${currentState.courseKey}')"><i class="fas fa-book"></i> Chapters</button>
            `;
        } else if (view === 'topics') {
            navHtml += `
                <button class="nav-link" onclick="showChapters('${currentState.courseKey}')"><i class="fas fa-book"></i> Chapters</button>
                <button class="nav-link active" onclick="showTopics(${currentState.chapterId})"><i class="fas fa-list"></i> ${course?.chapters[currentState.chapterId]?.shortTitle || 'Topics'}</button>
            `;
        } else if (view === 'content') {
            navHtml += `
                <button class="nav-link" onclick="showChapters('${currentState.courseKey}')"><i class="fas fa-book"></i> Chapters</button>
                <button class="nav-link" onclick="showTopics(${currentState.chapterId})"><i class="fas fa-list"></i> ${course?.chapters[currentState.chapterId]?.shortTitle || 'Topics'}</button>
                <button class="nav-link active"><i class="fas fa-file"></i> Topic</button>
            `;
        }
        
        navHtml += '</div>';
        
        let progressHtml = '<div class="nav-progress">';
        
        if (view === 'chapters') {
            progressHtml += `<i class="fas fa-book-open"></i> ${course?.chapters?.length || 0} Chapters`;
        } else if (view === 'topics') {
            const chapter = course?.chapters[currentState.chapterId];
            progressHtml += `<i class="fas fa-file"></i> ${chapter?.data?.sections?.length || 0} Topics`;
        } else if (view === 'content') {
            progressHtml += `<i class="fas fa-eye"></i> Reading Content`;
        }
        
        progressHtml += '</div>';
        
        navBar.innerHTML = navHtml + progressHtml;
    }

    // Update next/previous buttons
    function updateNavButtons(view) {
        const course = currentState.courseKey ? window.focusArea[currentState.courseKey] : null;
        const navButtons = document.getElementById('navButtons');
        
        let prevDisabled = true;
        let nextDisabled = true;
        let prevAction = '';
        let nextAction = '';
        let position = '';
        
        if (view === 'topics') {
            const chaptersCount = course?.chapters?.length || 0;
            prevDisabled = currentState.chapterId === 0;
            nextDisabled = currentState.chapterId === chaptersCount - 1;
            prevAction = `showTopics(${currentState.chapterId - 1})`;
            nextAction = `showTopics(${currentState.chapterId + 1})`;
            position = `<span class="position-indicator"><i class="fas fa-book"></i> Chapter ${currentState.chapterId + 1} of ${chaptersCount}</span>`;
        } else if (view === 'content') {
            const chapter = course?.chapters[currentState.chapterId];
            const topicsCount = chapter?.data?.sections?.length || 0;
            
            prevDisabled = currentState.topicId === 0;
            nextDisabled = currentState.topicId === topicsCount - 1;
            prevAction = `showContent(${currentState.chapterId}, ${currentState.topicId - 1})`;
            nextAction = `showContent(${currentState.chapterId}, ${currentState.topicId + 1})`;
            position = `<span class="position-indicator"><i class="fas fa-file"></i> Topic ${currentState.topicId + 1} of ${topicsCount}</span>`;
        }
        
        let prevButton = `<button class="nav-btn" onclick="${prevAction}" ${prevDisabled ? 'disabled' : ''}>
            <i class="fas fa-arrow-left"></i> Previous
        </button>`;
        
        let nextButton = `<button class="nav-btn" onclick="${nextAction}" ${nextDisabled ? 'disabled' : ''}>
            Next <i class="fas fa-arrow-right"></i>
        </button>`;
        
        navButtons.innerHTML = prevButton + position + nextButton;
    }

    // Debug function
    function debugFocusArea() {
        console.log("üîç DEBUG: Current focusArea content:");
        if (!window.focusArea || Object.keys(window.focusArea).length === 0) {
            console.log("   ‚ùå No courses loaded yet");
            return;
        }
        
        Object.keys(window.focusArea).forEach(courseKey => {
            const course = window.focusArea[courseKey];
            console.log(`\nüìö ${course.title}:`);
            console.log(`   Chapters: ${course.chapters?.length || 0}`);
            console.log(`   Expected: ${course.expectedChapters || 'N/A'}`);
            
            if (course.chapters) {
                course.chapters.forEach((ch, i) => {
                    console.log(`   ${i+1}. ${ch.title} (ID: ${ch.id})`);
                });
            }
        });
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Focus viewer loaded, waiting for focus areas...");
        setTimeout(waitForFocusAreas, 1000);
    });

    // Listen for focus areas loaded event
    window.addEventListener('focusAreasLoaded', function() {
        console.log("focusAreasLoaded event received");
        displayCourses();
        
        // Run debug after a short delay
        setTimeout(debugFocusArea, 500);
    });
</script>

</body>
</html>